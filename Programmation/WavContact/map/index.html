<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>WavMaps</title>

    <style type="text/css">
      #map {
        height: 700px;
        width: 100%;
      }
    </style>

    <script>
      let map, infoWindow;

      function initMap() {
        const geneve = { lat: 46.2043907, lng: 6.1431577 };

        /*
        // Simple ouverture de la maps sur le point donner
        const map = new google.maps.Map(document.getElementById("map"), {
          zoom: 11, // le zoom que l'on veux appliquer sur la carte au début (1 loin, +++ plus près)
          center: geneve,
        });
        */

        // Script pour la geolocalisation
        map = new google.maps.Map(document.getElementById("map"), {
          center: geneve, // centrer sur geneve
          zoom: 11,
        });
        infoWindow = new google.maps.InfoWindow();

        const locationButton = document.createElement("button");

        locationButton.textContent = "Cliquer pour trouver votre localisation";
        locationButton.classList.add("custom-map-control-button");
        map.controls[google.maps.ControlPosition.TOP_CENTER].push(locationButton);
        locationButton.addEventListener("click", () => {
          if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(
              (position) => {
                const pos = {
                  lat: position.coords.latitude,
                  lng: position.coords.longitude,
                };

                infoWindow.setPosition(pos);
                infoWindow.setContent("Vous êtes ici !");
                infoWindow.open(map);
                map.setCenter(pos);
              },
              () => {
                handleLocationError(true, infoWindow, map.getCenter());
              }
            );
          } else {
            handleLocationError(false, infoWindow, map.getCenter());
          }
        });

        // Noter le string du marker
        const infowindow = new google.maps.InfoWindow({
          content: "Waview",
        });

        // Permet de crée des points avec la lat et la long
        const marker = new google.maps.Marker({
          position: { lat: 46.2201647, lng : 6.0771042},
          map: map,
          title: "Waview",
        });

        // Permet de mettre un affichage sur le marker
        marker.addListener("click", () => {
          infowindow.open({
            anchor: marker,
            map,
            shouldFocus: false,
          });
        });

      }

      // Fonction utiliser pour la geolocalisation
      function handleLocationError(browserHasGeolocation, infoWindow, pos) {
        infoWindow.setPosition(pos);
        infoWindow.setContent(
          browserHasGeolocation
            ? "Erreur: La geolocalisation à échouer."
            : "Erreur: Votre moteur de recherche ne peu pas vous geolocaliser."
        );
        infoWindow.open(map);
      }
    </script>

  </head>
  <body>
    <h1>Voici notre application WavMaps</h1>

    <div id="map">
      <script
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCREy29Y020Q0EBK69pN4bb32jc72BmpFY&callback=initMap&libraries=&v=weekly"
        async
      ></script>
    </div>

  </body>
</html>
